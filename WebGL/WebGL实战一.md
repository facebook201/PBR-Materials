#### 原理篇 渲染管线

1、顶点着色器处理顶点

2、图元装配

3、光栅化

4、片元着色器

5、测试 混合



##### 存储限定符

attribute 只能出现在顶点着色器中，表示每个顶点的数据。在光栅化过程中会对attribute变量进行插值处理。可以从外部往WebGL内部中传递数据

uniform 可以出现在顶点着色器和片元着色器中，表示统一的值，每个顶点/片元使用的这个值都是一样的。

varying 可以出现在顶点着色器和片元着色器中，表示变化的值，在光栅化阶段，GPU将attribute变量插值处理后的结果赋给了varying变量，它是链接顶点着色器和片元着色器变量之间的桥梁。



#### js 传递变量

1. 传递attribute变量的数据（一般是顶点信息）
2. 传递一般的uniform变量数据（整数、浮点数、向量、矩阵）（一般是一些辅助信息，比如时间信息，某段程序需要根据时间的变化来计算最后的值）  
3. 传递纹理



#### 传递 Attribute 变量

1. 创建WebGLBuffer
2. 绑定Buffer到ARRAY_BUFFER（gl.bindBuffer()）
3. 传入数据



##### 传递 uniform 变量

1. 通过API获取uniform变量在WebGL程序中的地址(gl.getUniformLocation)
2. 再通过API这个地址中填充数据即可（gl.uniform1f， gl.uniform1i, gl.uniform2f......）



#### 法线贴图

法线贴图通常使用在一些模型精度不是很高，但是需要展示更多细节的地方。比如，我们需要渲染一面砖墙。我们当然可以在建模工具中将每一块的砖的顶点数据都表示出来，但是这样做的代价就是巨大的人工成本。而使用法线贴图则可以将砖墙的法线存储在一张图片中，在渲染时再进行计算。

法线贴图中存储的是物体的法线方向，由于法线方向处于[-1, 1]的范围之间，而像素颜色的 RGB 则处于[0,1]之间。那么我们需要做一个映射.所以 法线贴图会呈现蓝紫色

缺点：

* 不可重用，比如在一个立方体中我们要给每个面都贴上法线贴图的话，那么对于模型空间的法线贴图，我们需要“6”张不同的贴图。（这里的 6 加上引号是因为这 6 张图也可以合并为 1 张大图表示）

* 不可压缩，因为模型空间下需要完整的使用 rgb 三个分量的值，所以没有压缩的空间了。

  

#### 切线空间法线贴图

切线空间的坐标系的 z 轴是模型的原始法线方向，x 轴是顶点的切线(Tangent)方向。这个切线方向我们暂时可以理解为是沿着纹理坐标的 u 轴方向。如下图所示，x 轴为切线方向，y 轴为副切线方向，z 轴为法线方向。为了与模型空间的 x,y,z 轴区分，我们通常将其称为 `T(Tangent)`,`B(Bitangent)`,`N(Normal)`。切线空间的矩阵也称为 `TBN` 矩阵。

法线存储在哪都是可以的，后续的光照才是重点。

1、切线空间中记录的法线信息是相对信息，这意味着即便把该法线纹理应用另一个完全不同的网格上，也可以得到一个相对合理的结果。

2、可重用法线纹理，比如之前举例的立方体，在模型空间下我们需要使用“6”张法线纹理，但是在切线空间下，我们完全使用 1 张法线纹理就可以了。

3、可压缩，因为切线空间下的法线纹理 z 方向总是正方向，因此我们可以仅仅只存储切线和副切线的信息，再通过叉乘来计算出法线坐标



​												